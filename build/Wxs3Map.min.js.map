{"version":3,"sources":["webpack:///webpack/bootstrap 7e8bad93fe13b394d5da","webpack:///./src/index.js","webpack:///external \"_\"","webpack:///./src/ThreeDMapUntiled.js","webpack:///external \"THREE\"","webpack:///external \"TrackballControls\"","webpack:///./tiff-js/tiff.js","webpack:///./src/util/createQueryString.js","webpack:///./src/util/events.js","webpack:///./src/Line/Line.js","webpack:///./src/Line/clampLineString.js","webpack:///./src/Line/checkIntersect.js","webpack:///./src/Line/lineIntersect.js","webpack:///./src/util/transform.js","webpack:///external \"proj4\"","webpack:///./src/Texture.js","webpack:///./src/Terrain.js","webpack:///./src/Profiles.js","webpack:///./src/Envelope.js"],"names":["_","defaults","div","bbox","bboxCrs","wireframe","zMult","zInv","crs","texture","type","wmsUrl","wmsLayers","wmsFormat","wmsFormatMode","terrain","pixelsPerVertex","wcsUrl","wcsResolution","coverage","format","showBox","boxColor","profiles","extendDefaults","config","extend","confExtended","Dimensions","document","getElementById","width","clientWidth","height","clientHeight","envelope","metersWidth","metersHeight","imgWidth","imgHeight","imgCoefficient","Math","round","demWidth","demHeight","proportionWidth","proportionHeight","proportionAverage","Wxs3Map","dimensions","window","ThreeDMapUntiled","dim","events","reloadTimer","linesToClamp","_renderer","_createRenderer","_camera","_createCamera","_controls","_createControls","_material","_createMaterial","mesh","_createMesh","_scene","_createScene","appendChild","domElement","_render","fire","loadTerrain","_terrainLoaded","bind","loadTexture","_textureLoaded","addEventListener","_resizeMe","on","_clampLines","prototype","event","callback","context","add","getSides","load","_profilesLoaded","meshes","each","renderer","alpha","setSize","scene","fov","cameraHeight","camera","Z","sideLength","canvCoefficient","tan","PI","position","set","material","side","getGeometry","update","requestAnimationFrame","render","clearTimeout","setTimeout","_reloadAll","aspect","updateProjectionMatrix","addLine","lineGeom","lineStyle","line","threeLine","getThreeLine","needsClamp","push","oldLine","clamped","clamp","remove","TIFFParser","tiffDataView","undefined","littleEndian","fileDirectories","isLittleEndian","BOM","getBytes","console","log","TypeError","hasTowel","RangeError","getFieldTagName","fieldTag","fieldTagNames","fieldTagName","getFieldTypeName","fieldType","fieldTypeNames","fieldTypeName","getFieldTypeLength","fieldTypeLength","indexOf","getBits","numBits","byteOffset","bitOffset","extraBytes","floor","newByteOffset","totalBits","shiftRight","shiftLeft","rawBits","getUint8","getUint16","getUint32","chunkInfo","numBytes","offset","getFieldValues","typeCount","valueOffset","fieldValues","fieldValueSize","value","i","indexOffset","forEach","e","a","String","fromCharCode","clampColorSample","colorSample","bitsPerSample","multiplier","pow","makeRGBAFillValue","r","g","b","parseFileDirectory","numDirEntries","tiffFields","entryCount","nextIFDByteOffset","parseTIFF","tiffArrayBuffer","canvas","createElement","DataView","firstIFDByteOffset","fileDirectory","imageWidth","ImageWidth","values","imageLength","ImageLength","strips","compression","Compression","samplesPerPixel","SamplesPerPixel","sampleProperties","bitsPerPixel","hasBytesPerPixel","BitsPerSample","bitsPerSampleValues","hasBytesPerSample","bytesPerSample","bytesPerPixel","stripOffsetValues","StripOffsets","numStripOffsetValues","length","StripByteCounts","stripByteCountValues","ceil","Error","stripOffset","stripByteCount","jIncrement","getHeader","pixel","sample","currentSample","m","sampleOffset","getFloat32","sampleInfo","bits","blockLength","iterations","header","getInt8","currentByte","getContext","ctx","fillStyle","RowsPerStrip","rowsPerStrip","numStrips","imageLengthModRowsPerStrip","rowsInLastStrip","numRowsInStrip","numRowsInPreviousStrip","photometricInterpretation","PhotometricInterpretation","extraSamplesValues","numExtraSamples","ExtraSamples","ColorMap","colorMapValues","colorMapSampleSize","numPixels","yPadding","y","j","x","pixelSamples","red","green","blue","opacity","k","invertValue","index","samples","colorMapIndex","fillRect","createQueryString","params","map","key","encodeURIComponent","join","observers","data","observer","ALine","style","geometry","styleDefaults","color","linewidth","_createLine","points","vertices","point","z","coordMinX","minX","coordMinY","minY","computeBoundingBox","boundingBox","pixelMinX","min","pixelMinY","pixelWidth","abs","max","pixelHeight","xFactor","yFactor","linedata","coordinates","coord","mapCrs","pixelX","pixelY","loaded","calcZ","p1","p2","p3","det","l1","l2","l3","getDistance","sqrt","clampLineSegment","l","chain","faces","face","c","line1","line2","line3","ints","intersect","dist","flatten","sortBy","p","clampLineString","range","onSegment","q","orientation","val","checkIntersect2","q1","q2","o1","o2","o3","o4","Turn","d","f","A","B","Number","EPSILON","checkIntersect","p4","lineIntersect","x1","y1","x2","y2","x3","y3","x4","y4","ua","ub","denom","transform","defs","from","to","Texture","textureConfig","_getImageMap","imageCall","imgUrl","service","version","request","WIDTH","HEIGHT","layers","loader","image","minFilter","needsUpdate","xhr","Terrain","terrainConfig","isTiff","minHeight","midHeight","_getTiffHeights","tiffParser","tiffArray","response","heights","parseInt","_getXYZHeights","numVertices","lines","responseText","split","_parseHeights","maxHeight","_createGeometry","verticesNeedUpdate","demRequest","XMLHttpRequest","SERVICE","VERSION","REQUEST","COVERAGE","FORMAT","CRS","RESPONSE_CRS","wcsCall","responseType","open","onreadystatechange","readyState","send","_createSideMesh","filter","vertex","first","clone","last","sideGeometry","unshift","backGeom","group","filterLeft","filterBottom","filterRight","filterTop","Profiles","_transformPoint","sSource","sDest","_createProfile","profile","verticalGeometry","verticalMaterial","transparent","crsSource","crsDestination","pointStart","xyStart","pointEnd","xyEnd","newStartX","kX","newStartY","kY","newEndX","newEndY","newStartZ","zStart","newEndZ","zEnd","verticalMesh","modelLL","modelUR","Envelope","parseFloat","ne","sw","concat","getBbox"],"mappings":"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","file":"Wxs3Map.min.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId])\n \t\t\treturn installedModules[moduleId].exports;\n\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\texports: {},\n \t\t\tid: moduleId,\n \t\t\tloaded: false\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.loaded = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(0);\n\n\n\n/** WEBPACK FOOTER **\n ** webpack/bootstrap 7e8bad93fe13b394d5da\n **/","import * as _ from 'underscore';\r\n\r\nimport ThreeDMapUntiled from './ThreeDMapUntiled';\r\n\r\n\r\nimport Texture from './Texture';\r\nimport Terrain from './Terrain';\r\nimport Profiles from './Profiles';\r\nimport Envelope from './Envelope';\r\n\r\nvar defaults = {\r\n    div: 'map',\r\n    bbox: '7.856598,62.333035,8.583069,62.559503',\r\n    bboxCrs: 'EPSG:4326',\r\n    wireframe: false,\r\n    zMult: 1,\r\n    zInv: false,\r\n    crs: 'EPSG:32633',\r\n    texture: {\r\n        type: 'wms',\r\n        wmsUrl: 'http://openwms.statkart.no/skwms1/wms.topo2',\r\n        wmsLayers: 'topo2_WMS',\r\n        wmsFormat: 'image/png',\r\n        wmsFormatMode: ''\r\n    },\r\n    terrain: {\r\n        pixelsPerVertex: 8, //the resolution of the height model in the image\r\n        wcsUrl: 'http://wms.geonorge.no/skwms1/wcs.dtm',\r\n        wcsResolution: 10, //resolution of grid cell in meters\r\n        coverage: 'land_utm33_10m',\r\n        format: 'geotiff',\r\n        showBox: true,\r\n        boxColor: 0xdddddd\r\n    },\r\n    profiles: null\r\n};\r\n\r\nfunction extendDefaults(config) {\r\n    var texture = _.extend({}, defaults.texture, config.texture || {});\r\n    var terrain = _.extend({}, defaults.terrain, config.terrain || {});\r\n    var confExtended = _.extend({}, defaults, config);\r\n    confExtended.texture = texture;\r\n    confExtended.terrain = terrain;\r\n    return confExtended;\r\n};\r\n\r\nfunction Dimensions(config) {\r\n\r\n    var div = document.getElementById(config.div);\r\n    var width = div.clientWidth;\r\n    var height = div.clientHeight;\r\n\r\n    var envelope = Envelope(config.bbox, config.crs, config.bboxCrs);\r\n\r\n    var metersWidth = envelope.width();\r\n    var metersHeight = envelope.height();\r\n\r\n    //Adjust output image to canvas if not specified\r\n    var imgWidth, imgHeight;\r\n    if (!config.texture.imgWidth || !config.texture.imgHeight) {\r\n        var imgCoefficient = metersWidth / metersHeight;\r\n        if ((width / height) < imgCoefficient) {\r\n            imgWidth = width;\r\n            imgHeight = Math.round(imgWidth / imgCoefficient);\r\n        } else {\r\n            imgHeight = height;\r\n            imgWidth = Math.round(imgHeight * imgCoefficient);\r\n        }\r\n    } else {\r\n        imgWidth = config.texture.imgWidth;\r\n        imgHeight = config.texture.imgHeight;\r\n    }\r\n\r\n    //Compute the resolution of the height model in the image (pixelsPerVertex)\r\n    var demWidth = Math.round(imgWidth / config.terrain.pixelsPerVertex);\r\n    var demHeight = Math.round(imgHeight / config.terrain.pixelsPerVertex);\r\n\r\n    if (demWidth > metersWidth / config.terrain.wcsResolution) {\r\n        //ajust to avoid stairs in the model - reduce dem to actual resolution\r\n        demWidth = Math.round(metersWidth / config.terrain.wcsResolution);\r\n        demHeight = Math.round(metersHeight / config.terrain.wcsResolution);\r\n    }\r\n\r\n    // mapunits between vertexes in x-dimention\r\n    var proportionWidth = metersWidth / demWidth;\r\n\r\n    // mapunits between vertexes in y-dimention\r\n    var proportionHeight = metersHeight / demHeight;\r\n\r\n    // average mapunits between vertexes\r\n    var proportionAverage = ((proportionWidth + proportionHeight) / 2);\r\n\r\n    if (config.zInv) {\r\n        proportionAverage = proportionAverage * -1;\r\n    }\r\n    var zMult;\r\n    if (config.zMult) {\r\n        zMult = proportionAverage / config.zMult;\r\n    } else {\r\n        zMult = proportionAverage;\r\n    }\r\n\r\n    return {\r\n        config: config,\r\n        div: div,\r\n        envelope: envelope,\r\n        width: width,\r\n        height: height,\r\n        imgWidth: imgWidth,\r\n        imgHeight: imgHeight,\r\n        demWidth: demWidth,\r\n        demHeight: demHeight,\r\n        zMult: zMult,\r\n        crs: config.crs\r\n    };\r\n}\r\n\r\nfunction Wxs3Map(config) {\r\n    config = extendDefaults(config || {});\r\n    var dimensions = Dimensions(config);\r\n    var texture = Texture(config.texture, dimensions);\r\n    var terrain = Terrain(config.terrain, dimensions);\r\n    var profiles;\r\n    if (config.profiles) {\r\n        profiles = Profiles(config.profiles, terrain, dimensions);\r\n    }\r\n    return new ThreeDMapUntiled(dimensions, terrain, texture, profiles);\r\n}\r\n\r\nwindow.Wxs3Map = Wxs3Map;\r\n\r\nexport default Wxs3Map;\r\n\n\n\n/** WEBPACK FOOTER **\n ** ./src/index.js\n **/","module.exports = _;\n\n\n/*****************\n ** WEBPACK FOOTER\n ** external \"_\"\n ** module id = 1\n ** module chunks = 0\n **/","import {\r\n    WebGLRenderer,\r\n    Scene,\r\n    AmbientLight,\r\n    PerspectiveCamera,\r\n    PlaneGeometry,\r\n    MeshPhongMaterial,\r\n    Mesh,\r\n    DoubleSide,\r\n    FrontSide\r\n} from 'three';\r\nimport TrackballControls from 'three.trackball';\r\nimport * as _ from 'underscore';\r\n\r\nimport TIFFParser from './../tiff-js/tiff.js';\r\nimport createQueryString from './util/createQueryString';\r\nimport events from './util/events';\r\nimport Line from './Line/Line';\r\n\r\n\r\nvar ThreeDMapUntiled = function (dim, terrain, texture, profiles) {\r\n    this.dim = dim;\r\n    this.terrain = terrain;\r\n    this.texture = texture;\r\n    this.profiles = profiles;\r\n    this.events = events();\r\n\r\n    this.reloadTimer = -1;\r\n\r\n    this.linesToClamp = [];\r\n\r\n    this._renderer = this._createRenderer();\r\n    this._camera = this._createCamera();\r\n    this._controls = this._createControls();\r\n    this._material = this._createMaterial();\r\n\r\n    //Create Mesh and Scene\r\n    var mesh = this._createMesh();\r\n    this._scene = this._createScene(mesh);\r\n\r\n    //Add webgl canvas to div\r\n    this.dim.div.appendChild(this._renderer.domElement);\r\n\r\n    //Start renderer and listen to changes in geometry\r\n    this._render();\r\n\r\n    //Load height model and texture asynchronously\r\n    this.events.fire('onTerrainLoadStart');\r\n    this.terrain.loadTerrain(this._terrainLoaded.bind(this));\r\n\r\n    this.events.fire('onTextureLoadStart');\r\n    this.texture.loadTexture(this._material, this._textureLoaded.bind(this));\r\n\r\n    //Adust canvas if container is resized\r\n    window.addEventListener('resize', this._resizeMe.bind(this), false);\r\n    this.on('onTerrainLoadEnd', this._clampLines, this);\r\n};\r\n\r\nThreeDMapUntiled.prototype.on = function (event, callback, context) {\r\n    this.events.on(event, callback, context);\r\n};\r\n\r\n\r\nThreeDMapUntiled.prototype._terrainLoaded = function () {\r\n    this.events.fire('onTerrainLoadEnd');\r\n    this._scene.add(this.terrain.getSides());\r\n\r\n    if (this.profiles) {\r\n        this.profiles.load(this._profilesLoaded.bind(this));\r\n    }\r\n};\r\n\r\nThreeDMapUntiled.prototype._profilesLoaded = function (meshes) {\r\n    _.each(meshes, function (mesh) {\r\n        this._scene.add(mesh);\r\n    }, this);\r\n};\r\n\r\nThreeDMapUntiled.prototype._textureLoaded = function (texture) {\r\n    this.events.fire('onTextureLoadEnd');\r\n};\r\n\r\nThreeDMapUntiled.prototype._createRenderer = function () {\r\n    var renderer = new WebGLRenderer({\r\n        alpha: true\r\n    });\r\n    renderer.setSize(this.dim.width, this.dim.height);\r\n    return renderer;\r\n};\r\n\r\n\r\nThreeDMapUntiled.prototype._createScene = function (mesh) {\r\n    var scene = new Scene();\r\n\r\n    //Ambient Light for MeshPhongMaterial\r\n    scene.add(new AmbientLight(0xffffff));\r\n    scene.add(mesh);\r\n\r\n    return scene;\r\n};\r\n\r\nThreeDMapUntiled.prototype._createCamera = function () {\r\n    var fov = 45,\r\n        cameraHeight;\r\n\r\n    var camera = new PerspectiveCamera(\r\n        fov,\r\n        this.dim.width / this.dim.height,\r\n        0.1,\r\n        1000\r\n    );\r\n\r\n    // Some trig to find height for camera\r\n    if (!!this.dim.Z) {\r\n        cameraHeight = this.dim.Z;\r\n    } else {\r\n        //Adapt optimal side length according to canvas\r\n        var sideLength;\r\n        var canvCoefficient = this.dim.width / this.dim.height;\r\n        if (canvCoefficient < (this.dim.demWidth / this.dim.demHeight)) {\r\n            sideLength = this.dim.demWidth / canvCoefficient;\r\n        } else {\r\n            sideLength = this.dim.demHeight;\r\n        }\r\n\r\n        //calculate camera height\r\n        cameraHeight = (sideLength / 2) / Math.tan((fov / 2) * Math.PI / 180);\r\n    }\r\n\r\n    camera.position.set(0, 0, cameraHeight);\r\n    return camera;\r\n};\r\n\r\nThreeDMapUntiled.prototype._createMaterial = function () {\r\n    var material = new MeshPhongMaterial({ //for shading and Ambient Light\r\n        side: this.terrain.showBox ? FrontSide : DoubleSide\r\n    });\r\n    material.wireframe = this.dim.wireframe;\r\n    return material;\r\n};\r\n\r\nThreeDMapUntiled.prototype._createMesh = function () {\r\n    return new Mesh(this.terrain.getGeometry(), this._material);\r\n};\r\n\r\nThreeDMapUntiled.prototype._createControls = function () {\r\n    return new TrackballControls(this._camera);\r\n};\r\n\r\nThreeDMapUntiled.prototype._render = function () {\r\n    this._controls.update();\r\n    window.requestAnimationFrame(this._render.bind(this));\r\n    this._renderer.render(this._scene, this._camera);\r\n};\r\n\r\nThreeDMapUntiled.prototype._resizeMe = function () {\r\n    window.clearTimeout(this.reloadTimer);\r\n    this.reloadTimer = window.setTimeout(this._reloadAll.bind(this), 1000);\r\n    return;\r\n};\r\n\r\nThreeDMapUntiled.prototype._reloadAll = function () {\r\n    this.dim.width = this.dim.div.clientWidth;\r\n    this.dim.height = this.dim.div.clientHeight;\r\n\r\n    this._camera.aspect = this.dim.width / this.dim.height;\r\n    this._camera.updateProjectionMatrix();\r\n\r\n    delete(this._controls);\r\n    this._controls = this._createControls();\r\n    this._renderer.setSize(this.dim.width, this.dim.height);\r\n};\r\n\r\nThreeDMapUntiled.prototype.addLine = function (lineGeom, lineStyle) {\r\n    var line = Line(lineGeom, lineStyle, this.terrain.getGeometry(), this.dim.envelope);\r\n    var threeLine = line.getThreeLine();\r\n    this._scene.add(threeLine);\r\n    if (line.needsClamp()) {\r\n        this.linesToClamp.push(line);\r\n    }\r\n};\r\n\r\nThreeDMapUntiled.prototype._clampLines = function () {\r\n    _.each(this.linesToClamp, function (line) {\r\n        var oldLine = line.getThreeLine();\r\n        var clamped = line.clamp();\r\n        this._scene.remove(oldLine);\r\n        this._scene.add(clamped);\r\n    }, this);\r\n    this.linesToClamp = [];\r\n};\r\n\r\nexport default ThreeDMapUntiled;\r\n\n\n\n/** WEBPACK FOOTER **\n ** ./src/ThreeDMapUntiled.js\n **/","module.exports = THREE;\n\n\n/*****************\n ** WEBPACK FOOTER\n ** external \"THREE\"\n ** module id = 3\n ** module chunks = 0\n **/","module.exports = TrackballControls;\n\n\n/*****************\n ** WEBPACK FOOTER\n ** external \"TrackballControls\"\n ** module id = 4\n ** module chunks = 0\n **/","/* This Source Code Form is subject to the terms of the Mozilla Public\r\n * License, v. 2.0. If a copy of the MPL was not distributed with this\r\n * file, You can obtain one at http://mozilla.org/MPL/2.0/. */\r\n\r\n\"use strict\";\r\n\r\nfunction TIFFParser() {\r\n\tthis.tiffDataView = undefined;\r\n\tthis.littleEndian = undefined;\r\n\tthis.fileDirectories = [];\r\n};\r\n\r\nTIFFParser.prototype = {\r\n\tisLittleEndian: function () {\r\n\t\t// Get byte order mark.\r\n\t\tvar BOM = this.getBytes(2, 0);\r\n\r\n\t\t// Find out the endianness.\r\n\t\tif (BOM === 0x4949) {\r\n\t\t\tthis.littleEndian = true;\r\n\t\t} else if (BOM === 0x4D4D) {\r\n\t\t\tthis.littleEndian = false;\r\n\t\t} else {\r\n\t\t\tconsole.log( BOM );\r\n\t\t\tthrow TypeError(\"Invalid byte order value.\");\r\n\t\t}\r\n\r\n\t\treturn this.littleEndian;\r\n\t},\r\n\r\n\thasTowel: function () {\r\n\t\t// Check for towel.\r\n\t\tif (this.getBytes(2, 2) !== 42) {\r\n\t\t\tthrow RangeError(\"You forgot your towel!\");\r\n\t\t\treturn false;\r\n\t\t}\r\n\r\n\t\treturn true;\r\n\t},\r\n\r\n\tgetFieldTagName: function (fieldTag) {\r\n\t\t// See: http://www.digitizationguidelines.gov/guidelines/TIFF_Metadata_Final.pdf\r\n\t\t// See: http://www.digitalpreservation.gov/formats/content/tiff_tags.shtml\r\n\t\tvar fieldTagNames = {\r\n\t\t\t// TIFF Baseline\r\n\t\t\t0x013B: 'Artist',\r\n\t\t\t0x0102: 'BitsPerSample',\r\n\t\t\t0x0109: 'CellLength',\r\n\t\t\t0x0108: 'CellWidth',\r\n\t\t\t0x0140: 'ColorMap',\r\n\t\t\t0x0103: 'Compression',\r\n\t\t\t0x8298: 'Copyright',\r\n\t\t\t0x0132: 'DateTime',\r\n\t\t\t0x0152: 'ExtraSamples',\r\n\t\t\t0x010A: 'FillOrder',\r\n\t\t\t0x0121: 'FreeByteCounts',\r\n\t\t\t0x0120: 'FreeOffsets',\r\n\t\t\t0x0123: 'GrayResponseCurve',\r\n\t\t\t0x0122: 'GrayResponseUnit',\r\n\t\t\t0x013C: 'HostComputer',\r\n\t\t\t0x010E: 'ImageDescription',\r\n\t\t\t0x0101: 'ImageLength',\r\n\t\t\t0x0100: 'ImageWidth',\r\n\t\t\t0x010F: 'Make',\r\n\t\t\t0x0119: 'MaxSampleValue',\r\n\t\t\t0x0118: 'MinSampleValue',\r\n\t\t\t0x0110: 'Model',\r\n\t\t\t0x00FE: 'NewSubfileType',\r\n\t\t\t0x0112: 'Orientation',\r\n\t\t\t0x0106: 'PhotometricInterpretation',\r\n\t\t\t0x011C: 'PlanarConfiguration',\r\n\t\t\t0x0128: 'ResolutionUnit',\r\n\t\t\t0x0116: 'RowsPerStrip',\r\n\t\t\t0x0115: 'SamplesPerPixel',\r\n\t\t\t0x0131: 'Software',\r\n\t\t\t0x0117: 'StripByteCounts',\r\n\t\t\t0x0111: 'StripOffsets',\r\n\t\t\t0x00FF: 'SubfileType',\r\n\t\t\t0x0107: 'Threshholding',\r\n\t\t\t0x011A: 'XResolution',\r\n\t\t\t0x011B: 'YResolution',\r\n\r\n\t\t\t// TIFF Extended\r\n\t\t\t0x0146: 'BadFaxLines',\r\n\t\t\t0x0147: 'CleanFaxData',\r\n\t\t\t0x0157: 'ClipPath',\r\n\t\t\t0x0148: 'ConsecutiveBadFaxLines',\r\n\t\t\t0x01B1: 'Decode',\r\n\t\t\t0x01B2: 'DefaultImageColor',\r\n\t\t\t0x010D: 'DocumentName',\r\n\t\t\t0x0150: 'DotRange',\r\n\t\t\t0x0141: 'HalftoneHints',\r\n\t\t\t0x015A: 'Indexed',\r\n\t\t\t0x015B: 'JPEGTables',\r\n\t\t\t0x011D: 'PageName',\r\n\t\t\t0x0129: 'PageNumber',\r\n\t\t\t0x013D: 'Predictor',\r\n\t\t\t0x013F: 'PrimaryChromaticities',\r\n\t\t\t0x0214: 'ReferenceBlackWhite',\r\n\t\t\t0x0153: 'SampleFormat',\r\n\t\t\t0x022F: 'StripRowCounts',\r\n\t\t\t0x014A: 'SubIFDs',\r\n\t\t\t0x0124: 'T4Options',\r\n\t\t\t0x0125: 'T6Options',\r\n\t\t\t0x0145: 'TileByteCounts',\r\n\t\t\t0x0143: 'TileLength',\r\n\t\t\t0x0144: 'TileOffsets',\r\n\t\t\t0x0142: 'TileWidth',\r\n\t\t\t0x012D: 'TransferFunction',\r\n\t\t\t0x013E: 'WhitePoint',\r\n\t\t\t0x0158: 'XClipPathUnits',\r\n\t\t\t0x011E: 'XPosition',\r\n\t\t\t0x0211: 'YCbCrCoefficients',\r\n\t\t\t0x0213: 'YCbCrPositioning',\r\n\t\t\t0x0212: 'YCbCrSubSampling',\r\n\t\t\t0x0159: 'YClipPathUnits',\r\n\t\t\t0x011F: 'YPosition',\r\n\r\n\t\t\t// EXIF\r\n\t\t\t0x9202: 'ApertureValue',\r\n\t\t\t0xA001: 'ColorSpace',\r\n\t\t\t0x9004: 'DateTimeDigitized',\r\n\t\t\t0x9003: 'DateTimeOriginal',\r\n\t\t\t0x8769: 'Exif IFD',\r\n\t\t\t0x9000: 'ExifVersion',\r\n\t\t\t0x829A: 'ExposureTime',\r\n\t\t\t0xA300: 'FileSource',\r\n\t\t\t0x9209: 'Flash',\r\n\t\t\t0xA000: 'FlashpixVersion',\r\n\t\t\t0x829D: 'FNumber',\r\n\t\t\t0xA420: 'ImageUniqueID',\r\n\t\t\t0x9208: 'LightSource',\r\n\t\t\t0x927C: 'MakerNote',\r\n\t\t\t0x9201: 'ShutterSpeedValue',\r\n\t\t\t0x9286: 'UserComment',\r\n\r\n\t\t\t// IPTC\r\n\t\t\t0x83BB: 'IPTC',\r\n\r\n\t\t\t// ICC\r\n\t\t\t0x8773: 'ICC Profile',\r\n\r\n\t\t\t// XMP\r\n\t\t\t0x02BC: 'XMP',\r\n\r\n\t\t\t// GDAL\r\n\t\t\t0xA480: 'GDAL_METADATA',\r\n\t\t\t0xA481: 'GDAL_NODATA',\r\n\r\n\t\t\t// Photoshop\r\n\t\t\t0x8649: 'Photoshop',\r\n\t\t};\r\n\r\n\t\tvar fieldTagName;\r\n\r\n\t\tif (fieldTag in fieldTagNames) {\r\n\t\t\tfieldTagName = fieldTagNames[fieldTag];\r\n\t\t} else {\r\n\t\t\t//console.log( \"Unknown Field Tag:\", fieldTag);\r\n\t\t\tfieldTagName = \"Tag\" + fieldTag;\r\n\t\t}\r\n\r\n\t\treturn fieldTagName;\r\n\t},\r\n\r\n\tgetFieldTypeName: function (fieldType) {\r\n\t\tvar fieldTypeNames = {\r\n\t\t\t0x0001: 'BYTE',\r\n\t\t\t0x0002: 'ASCII',\r\n\t\t\t0x0003: 'SHORT',\r\n\t\t\t0x0004: 'LONG',\r\n\t\t\t0x0005: 'RATIONAL',\r\n\t\t\t0x0006: 'SBYTE',\r\n\t\t\t0x0007: 'UNDEFINED',\r\n\t\t\t0x0008: 'SSHORT',\r\n\t\t\t0x0009: 'SLONG',\r\n\t\t\t0x000A: 'SRATIONAL',\r\n\t\t\t0x000B: 'FLOAT',\r\n\t\t\t0x000C: 'DOUBLE',\r\n\t\t};\r\n\r\n\t\tvar fieldTypeName;\r\n\r\n\t\tif (fieldType in fieldTypeNames) {\r\n\t\t\tfieldTypeName = fieldTypeNames[fieldType];\r\n\t\t}\r\n\r\n\t\treturn fieldTypeName;\r\n\t},\r\n\r\n\tgetFieldTypeLength: function (fieldTypeName) {\r\n\t\tvar fieldTypeLength;\r\n\r\n\t\tif (['BYTE', 'ASCII', 'SBYTE', 'UNDEFINED'].indexOf(fieldTypeName) !== -1) {\r\n\t\t\tfieldTypeLength = 1;\r\n\t\t} else if (['SHORT', 'SSHORT'].indexOf(fieldTypeName) !== -1) {\r\n\t\t\tfieldTypeLength = 2;\r\n\t\t} else if (['LONG', 'SLONG', 'FLOAT'].indexOf(fieldTypeName) !== -1) {\r\n\t\t\tfieldTypeLength = 4;\r\n\t\t} else if (['RATIONAL', 'SRATIONAL', 'DOUBLE'].indexOf(fieldTypeName) !== -1) {\r\n\t\t\tfieldTypeLength = 8;\r\n\t\t}\r\n\r\n\t\treturn fieldTypeLength;\r\n\t},\r\n\r\n\tgetBits: function (numBits, byteOffset, bitOffset) {\r\n\t\tbitOffset = bitOffset || 0;\r\n\t\tvar extraBytes = Math.floor(bitOffset / 8);\r\n\t\tvar newByteOffset = byteOffset + extraBytes;\r\n\t\tvar totalBits = bitOffset + numBits;\r\n\t\tvar shiftRight = 32 - numBits;\r\n\r\n\t\tif (totalBits <= 0) {\r\n\t\t\tconsole.log( numBits, byteOffset, bitOffset );\r\n\t\t\tthrow RangeError(\"No bits requested\");\r\n\t\t} else if (totalBits <= 8) {\r\n\t\t\tvar shiftLeft = 24 + bitOffset;\r\n\t\t\tvar rawBits = this.tiffDataView.getUint8(newByteOffset, this.littleEndian);\r\n\t\t} else if (totalBits <= 16) {\r\n\t\t\tvar shiftLeft = 16 + bitOffset;\r\n\t\t\tvar rawBits = this.tiffDataView.getUint16(newByteOffset, this.littleEndian);\r\n\t\t} else if (totalBits <= 32) {\r\n\t\t\tvar shiftLeft = bitOffset;\r\n\t\t\tvar rawBits = this.tiffDataView.getUint32(newByteOffset, this.littleEndian);\r\n\t\t} else {\r\n\t\t\tconsole.log( numBits, byteOffset, bitOffset );\r\n\t\t\tthrow RangeError(\"Too many bits requested\");\r\n\t\t}\r\n\r\n\t\tvar chunkInfo = {\r\n\t\t\t'bits': ((rawBits << shiftLeft) >>> shiftRight),\r\n\t\t\t'byteOffset': newByteOffset + Math.floor(totalBits / 8),\r\n\t\t\t'bitOffset': totalBits % 8,\r\n\t\t};\r\n\r\n\t\treturn chunkInfo;\r\n\t},\r\n\r\n\tgetBytes: function (numBytes, offset) {\r\n\t\tif (numBytes <= 0) {\r\n\t\t\tconsole.log( numBytes, offset );\r\n\t\t\tthrow RangeError(\"No bytes requested\");\r\n\t\t} else if (numBytes <= 1) {\r\n\t\t\treturn this.tiffDataView.getUint8(offset, this.littleEndian);\r\n\t\t} else if (numBytes <= 2) {\r\n\t\t\treturn this.tiffDataView.getUint16(offset, this.littleEndian);\r\n\t\t} else if (numBytes <= 3) {\r\n\t\t\treturn this.tiffDataView.getUint32(offset, this.littleEndian) >>> 8;\r\n\t\t} else if (numBytes <= 4) {\r\n\t\t\treturn this.tiffDataView.getUint32(offset, this.littleEndian);\r\n            //return this.tiffDataView.getFloat32(offset, this.littleEndian);\r\n\t\t} else {\r\n\t\t\tconsole.log( numBytes, offset );\r\n\t\t\tthrow RangeError(\"Too many bytes requested\");\r\n\t\t}\r\n\t},\r\n\r\n\tgetFieldValues: function (fieldTagName, fieldTypeName, typeCount, valueOffset) {\r\n\t\tvar fieldValues = [];\r\n\r\n\t\tvar fieldTypeLength = this.getFieldTypeLength(fieldTypeName);\r\n\t\tvar fieldValueSize = fieldTypeLength * typeCount;\r\n\r\n\t\tif (fieldValueSize <= 4) {\r\n\t\t\t// The value is stored at the big end of the valueOffset.\r\n\t\t\tif (this.littleEndian === false) {\r\n\t\t\t\tvar value = valueOffset >>> ((4 - fieldTypeLength) * 8);\r\n\t\t\t} else {\r\n\t\t\t\tvar value = valueOffset;\r\n\t\t\t}\r\n\r\n\t\t\tfieldValues.push(value);\r\n\t\t} else {\r\n\t\t\tfor (var i = 0; i < typeCount; i++) {\r\n\t\t\t\tvar indexOffset = fieldTypeLength * i;\r\n\r\n\t\t\t\tif (fieldTypeLength >= 8) {\r\n\t\t\t\t\tif (['RATIONAL', 'SRATIONAL'].indexOf(fieldTypeName) !== -1) {\r\n\t\t\t\t\t\t// Numerator\r\n\t\t\t\t\t\tfieldValues.push(this.getBytes(4, valueOffset + indexOffset));\r\n\t\t\t\t\t\t// Denominator\r\n\t\t\t\t\t\tfieldValues.push(this.getBytes(4, valueOffset + indexOffset + 4));\r\n\t\t\t\t\t} else if (['DOUBLE'].indexOf(fieldTypeName) !== -1) {\r\n\t\t\t\t\t\tfieldValues.push(this.getBytes(4, valueOffset + indexOffset) + this.getBytes(4, valueOffset + indexOffset + 4));\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tconsole.log( fieldTypeName, typeCount, fieldValueSize );\r\n\t\t\t\t\t\tthrow TypeError(\"Can't handle this field type or size\");\r\n\t\t\t\t\t}\r\n\t\t\t\t} else {\r\n\t\t\t\t\tfieldValues.push(this.getBytes(fieldTypeLength, valueOffset + indexOffset));\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif (fieldTypeName === 'ASCII') {\r\n\t\t\tfieldValues.forEach(function(e, i, a) { a[i] = String.fromCharCode(e); });\r\n\t\t}\r\n\r\n\t\treturn fieldValues;\r\n\t},\r\n\r\n\tclampColorSample: function(colorSample, bitsPerSample) {\r\n\t\tvar multiplier = Math.pow(2, 8 - bitsPerSample);\r\n\r\n\t\treturn Math.floor((colorSample * multiplier) + (multiplier - 1));\r\n\t},\r\n\r\n\tmakeRGBAFillValue: function(r, g, b, a) {\r\n\t\tif(typeof a === 'undefined') {\r\n\t\t\ta = 1.0;\r\n\t\t}\r\n\t\treturn \"rgba(\" + r + \", \" + g + \", \" + b + \", \" + a + \")\";\r\n\t},\r\n\r\n\tparseFileDirectory: function (byteOffset) {\r\n\t\tvar numDirEntries = this.getBytes(2, byteOffset);\r\n\r\n\t\tvar tiffFields = [];\r\n\r\n\t\tfor (var i = byteOffset + 2, entryCount = 0; entryCount < numDirEntries; i += 12, entryCount++) {\r\n\t\t\tvar fieldTag = this.getBytes(2, i);\r\n\t\t\tvar fieldType = this.getBytes(2, i + 2);\r\n\t\t\tvar typeCount = this.getBytes(4, i + 4);\r\n\t\t\tvar valueOffset = this.getBytes(4, i + 8);\r\n\r\n\t\t\tvar fieldTagName = this.getFieldTagName( fieldTag );\r\n\t\t\tvar fieldTypeName = this.getFieldTypeName( fieldType );\r\n\r\n\t\t\tvar fieldValues = this.getFieldValues(fieldTagName, fieldTypeName, typeCount, valueOffset);\r\n\r\n\t\t\ttiffFields[fieldTagName] = { 'type': fieldTypeName, 'values': fieldValues };\r\n\t\t}\r\n\r\n\t\tthis.fileDirectories.push( tiffFields );\r\n\r\n\t\tvar nextIFDByteOffset = this.getBytes(4, i);\r\n\r\n\t\tif (nextIFDByteOffset === 0x00000000) {\r\n\t\t\treturn this.fileDirectories;\r\n\t\t} else {\r\n\t\t\treturn this.parseFileDirectory(nextIFDByteOffset);\r\n\t\t}\r\n\t},\r\n\r\n\tparseTIFF: function (tiffArrayBuffer, canvas) {\r\n\t\tcanvas = canvas || document.createElement('canvas');\r\n\r\n\t\tthis.tiffDataView = new DataView(tiffArrayBuffer);\r\n\t\tthis.canvas = canvas;\r\n\r\n\t\tthis.littleEndian = this.isLittleEndian(this.tiffDataView);\r\n\r\n\t\tif (!this.hasTowel(this.tiffDataView, this.littleEndian)) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tvar firstIFDByteOffset = this.getBytes(4, 4);\r\n\r\n\t\tthis.fileDirectories = this.parseFileDirectory(firstIFDByteOffset);\r\n\r\n\t\tvar fileDirectory = this.fileDirectories[0];\r\n\r\n\t\t//console.log( fileDirectory );\r\n\r\n\t\tvar imageWidth = fileDirectory.ImageWidth.values[0];\r\n\t\tvar imageLength = fileDirectory.ImageLength.values[0];\r\n\r\n\t\tthis.canvas.width = imageWidth;\r\n\t\tthis.canvas.height = imageLength;\r\n\r\n\t\tvar strips = [];\r\n\r\n\t\tvar compression = (fileDirectory.Compression) ? fileDirectory.Compression.values[0] : 1;\r\n\r\n\t\tvar samplesPerPixel = fileDirectory.SamplesPerPixel.values[0];\r\n\r\n\t\tvar sampleProperties = [];\r\n\r\n\t\tvar bitsPerPixel = 0;\r\n\t\tvar hasBytesPerPixel = false;\r\n\r\n\t\tfileDirectory.BitsPerSample.values.forEach(function(bitsPerSample, i, bitsPerSampleValues) {\r\n\t\t\tsampleProperties[i] = {\r\n\t\t\t\t'bitsPerSample': bitsPerSample,\r\n\t\t\t\t'hasBytesPerSample': false,\r\n\t\t\t\t'bytesPerSample': undefined,\r\n\t\t\t};\r\n\r\n\t\t\tif ((bitsPerSample % 8) === 0) {\r\n\t\t\t\tsampleProperties[i].hasBytesPerSample = true;\r\n\t\t\t\tsampleProperties[i].bytesPerSample = bitsPerSample / 8;\r\n\t\t\t}\r\n\r\n\t\t\tbitsPerPixel += bitsPerSample;\r\n\t\t}, this);\r\n\r\n\t\tif ((bitsPerPixel % 8) === 0) {\r\n\t\t\thasBytesPerPixel = true;\r\n\t\t\tvar bytesPerPixel = bitsPerPixel / 8;\r\n\t\t}\r\n\r\n\t\tvar stripOffsetValues = fileDirectory.StripOffsets.values;\r\n\t\tvar numStripOffsetValues = stripOffsetValues.length;\r\n\r\n\t\t// StripByteCounts is supposed to be required, but see if we can recover anyway.\r\n\t\tif (fileDirectory.StripByteCounts) {\r\n\t\t\tvar stripByteCountValues = fileDirectory.StripByteCounts.values;\r\n\t\t} else {\r\n\t\t\tconsole.log(\"Missing StripByteCounts!\");\r\n\r\n\t\t\t// Infer StripByteCounts, if possible.\r\n\t\t\tif (numStripOffsetValues === 1) {\r\n\t\t\t\tvar stripByteCountValues = [Math.ceil((imageWidth * imageLength * bitsPerPixel) / 8)];\r\n\t\t\t} else {\r\n\t\t\t\tthrow Error(\"Cannot recover from missing StripByteCounts\");\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// Loop through strips and decompress as necessary.\r\n\t\tfor (var i = 0; i < numStripOffsetValues; i++) {\r\n\t\t\tvar stripOffset = stripOffsetValues[i];\r\n\t\t\tstrips[i] = [];\r\n\r\n\t\t\tvar stripByteCount = stripByteCountValues[i];\r\n\r\n\t\t\t// Loop through pixels.\r\n\t\t\tfor (var byteOffset = 0, bitOffset = 0, jIncrement = 1, getHeader = true, pixel = [], numBytes = 0, sample = 0, currentSample = 0; byteOffset < stripByteCount; byteOffset += jIncrement) {\r\n\t\t\t\t// Decompress strip.\r\n\t\t\t\tswitch (compression) {\r\n\t\t\t\t\t// Uncompressed\r\n\t\t\t\t\tcase 1:\r\n\t\t\t\t\t\t// Loop through samples (sub-pixels).\r\n\t\t\t\t\t\tfor (var m = 0, pixel = []; m < samplesPerPixel; m++) {\r\n\t\t\t\t\t\t\tif (sampleProperties[m].hasBytesPerSample) {\r\n\t\t\t\t\t\t\t\t// XXX: This is wrong!\r\n\t\t\t\t\t\t\t\tvar sampleOffset = sampleProperties[m].bytesPerSample * m;\r\n\r\n\t\t\t\t\t\t\t\t//pixel.push(this.getBytes(sampleProperties[m].bytesPerSample, stripOffset + byteOffset + sampleOffset));\r\n                                pixel.push(this.tiffDataView.getFloat32(stripOffset + byteOffset + sampleOffset, this.littleEndian ));\r\n\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\tvar sampleInfo = this.getBits(sampleProperties[m].bitsPerSample, stripOffset + byteOffset, bitOffset);\r\n\r\n\t\t\t\t\t\t\t\tpixel.push(sampleInfo.bits);\r\n\r\n\t\t\t\t\t\t\t\tbyteOffset = sampleInfo.byteOffset - stripOffset;\r\n\t\t\t\t\t\t\t\tbitOffset = sampleInfo.bitOffset;\r\n\r\n\t\t\t\t\t\t\t\tthrow RangeError(\"Cannot handle sub-byte bits per sample\");\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\tstrips[i].push(pixel);\r\n\r\n\t\t\t\t\t\tif (hasBytesPerPixel) {\r\n\t\t\t\t\t\t\tjIncrement = bytesPerPixel;\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\tjIncrement = 0;\r\n\r\n\t\t\t\t\t\t\tthrow RangeError(\"Cannot handle sub-byte bits per pixel\");\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\t// CITT Group 3 1-Dimensional Modified Huffman run-length encoding\r\n\t\t\t\t\tcase 2:\r\n\t\t\t\t\t\t// XXX: Use PDF.js code?\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\t// Group 3 Fax\r\n\t\t\t\t\tcase 3:\r\n\t\t\t\t\t\t// XXX: Use PDF.js code?\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\t// Group 4 Fax\r\n\t\t\t\t\tcase 4:\r\n\t\t\t\t\t\t// XXX: Use PDF.js code?\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\t// LZW\r\n\t\t\t\t\tcase 5:\r\n\t\t\t\t\t\t// XXX: Use PDF.js code?\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\t// Old-style JPEG (TIFF 6.0)\r\n\t\t\t\t\tcase 6:\r\n\t\t\t\t\t\t// XXX: Use PDF.js code?\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\t// New-style JPEG (TIFF Specification Supplement 2)\r\n\t\t\t\t\tcase 7:\r\n\t\t\t\t\t\t// XXX: Use PDF.js code?\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\t// PackBits\r\n\t\t\t\t\tcase 32773:\r\n\t\t\t\t\t\t// Are we ready for a new block?\r\n\t\t\t\t\t\tif (getHeader) {\r\n\t\t\t\t\t\t\tgetHeader = false;\r\n\r\n\t\t\t\t\t\t\tvar blockLength = 1;\r\n\t\t\t\t\t\t\tvar iterations = 1;\r\n\r\n\t\t\t\t\t\t\t// The header byte is signed.\r\n\t\t\t\t\t\t\tvar header = this.tiffDataView.getInt8(stripOffset + byteOffset, this.littleEndian);\r\n\r\n\t\t\t\t\t\t\tif ((header >= 0) && (header <= 127)) { // Normal pixels.\r\n\t\t\t\t\t\t\t\tblockLength = header + 1;\r\n\t\t\t\t\t\t\t} else if ((header >= -127) && (header <= -1)) { // Collapsed pixels.\r\n\t\t\t\t\t\t\t\titerations = -header + 1;\r\n\t\t\t\t\t\t\t} else /*if (header === -128)*/ { // Placeholder byte?\r\n\t\t\t\t\t\t\t\tgetHeader = true;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\tvar currentByte = this.getBytes(1, stripOffset + byteOffset);\r\n\r\n\t\t\t\t\t\t\t// Duplicate bytes, if necessary.\r\n\t\t\t\t\t\t\tfor (var m = 0; m < iterations; m++) {\r\n\t\t\t\t\t\t\t\tif (sampleProperties[sample].hasBytesPerSample) {\r\n\t\t\t\t\t\t\t\t\t// We're reading one byte at a time, so we need to handle multi-byte samples.\r\n\t\t\t\t\t\t\t\t\tcurrentSample = (currentSample << (8 * numBytes)) | currentByte;\r\n\t\t\t\t\t\t\t\t\tnumBytes++;\r\n\r\n\t\t\t\t\t\t\t\t\t// Is our sample complete?\r\n\t\t\t\t\t\t\t\t\tif (numBytes === sampleProperties[sample].bytesPerSample) {\r\n\t\t\t\t\t\t\t\t\t\tpixel.push(currentSample);\r\n\t\t\t\t\t\t\t\t\t\tcurrentSample = numBytes = 0;\r\n\t\t\t\t\t\t\t\t\t\tsample++;\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\t\tthrow RangeError(\"Cannot handle sub-byte bits per sample\");\r\n\t\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\t\t// Is our pixel complete?\r\n\t\t\t\t\t\t\t\tif (sample === samplesPerPixel)\r\n\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\tstrips[i].push(pixel);\r\n\r\n\t\t\t\t\t\t\t\t\tpixel = [];\r\n\t\t\t\t\t\t\t\t\tsample = 0;\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\tblockLength--;\r\n\r\n\t\t\t\t\t\t\t// Is our block complete?\r\n\t\t\t\t\t\t\tif (blockLength === 0) {\r\n\t\t\t\t\t\t\t\tgetHeader = true;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\tjIncrement = 1;\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\t// Unknown compression algorithm\r\n\t\t\t\t\tdefault:\r\n\t\t\t\t\t\t// Do not attempt to parse the image data.\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n//\t\t\tconsole.log( strips[i] );\r\n\t\t}\r\n\r\n\t\t//console.log( strips );\r\n        return strips;\r\n\r\n\t\tif (canvas.getContext) {\r\n\t\t\tvar ctx = this.canvas.getContext(\"2d\");\r\n\r\n\t\t\t// Set a default fill style.\r\n\t\t\tctx.fillStyle = this.makeRGBAFillValue(255, 255, 255, 0);\r\n\r\n\t\t\t// If RowsPerStrip is missing, the whole image is in one strip.\r\n\t\t\tif (fileDirectory.RowsPerStrip) {\r\n\t\t\t\tvar rowsPerStrip = fileDirectory.RowsPerStrip.values[0];\r\n\t\t\t} else {\r\n\t\t\t\tvar rowsPerStrip = imageLength;\r\n\t\t\t}\r\n\r\n\t\t\tvar numStrips = strips.length;\r\n\r\n\t\t\tvar imageLengthModRowsPerStrip = imageLength % rowsPerStrip;\r\n\t\t\tvar rowsInLastStrip = (imageLengthModRowsPerStrip === 0) ? rowsPerStrip : imageLengthModRowsPerStrip;\r\n\r\n\t\t\tvar numRowsInStrip = rowsPerStrip;\r\n\t\t\tvar numRowsInPreviousStrip = 0;\r\n\r\n\t\t\tvar photometricInterpretation = fileDirectory.PhotometricInterpretation.values[0];\r\n\r\n\t\t\tvar extraSamplesValues = [];\r\n\t\t\tvar numExtraSamples = 0;\r\n\r\n\t\t\tif (fileDirectory.ExtraSamples) {\r\n\t\t\t\textraSamplesValues = fileDirectory.ExtraSamples.values;\r\n\t\t\t\tnumExtraSamples = extraSamplesValues.length;\r\n\t\t\t}\r\n\r\n\t\t\tif (fileDirectory.ColorMap) {\r\n\t\t\t\tvar colorMapValues = fileDirectory.ColorMap.values;\r\n\t\t\t\tvar colorMapSampleSize = Math.pow(2, sampleProperties[0].bitsPerSample);\r\n\t\t\t}\r\n\r\n\t\t\t// Loop through the strips in the image.\r\n\t\t\tfor (var i = 0; i < numStrips; i++) {\r\n\t\t\t\t// The last strip may be short.\r\n\t\t\t\tif ((i + 1) === numStrips) {\r\n\t\t\t\t\tnumRowsInStrip = rowsInLastStrip;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tvar numPixels = strips[i].length;\r\n\t\t\t\tvar yPadding = numRowsInPreviousStrip * i;\r\n\r\n\t\t\t\t// Loop through the rows in the strip.\r\n\t\t\t\tfor (var y = 0, j = 0; y < numRowsInStrip, j < numPixels; y++) {\r\n\t\t\t\t\t// Loop through the pixels in the row.\r\n\t\t\t\t\tfor (var x = 0; x < imageWidth; x++, j++) {\r\n\t\t\t\t\t\tvar pixelSamples = strips[i][j];\r\n\r\n\t\t\t\t\t\tvar red = 0;\r\n\t\t\t\t\t\tvar green = 0;\r\n\t\t\t\t\t\tvar blue = 0;\r\n\t\t\t\t\t\tvar opacity = 1.0;\r\n\r\n\t\t\t\t\t\tif (numExtraSamples > 0) {\r\n\t\t\t\t\t\t\tfor (var k = 0; k < numExtraSamples; k++) {\r\n\t\t\t\t\t\t\t\tif (extraSamplesValues[k] === 1 || extraSamplesValues[k] === 2) {\r\n\t\t\t\t\t\t\t\t\t// Clamp opacity to the range [0,1].\r\n\t\t\t\t\t\t\t\t\topacity = pixelSamples[3 + k] / 256;\r\n\r\n\t\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\tswitch (photometricInterpretation) {\r\n\t\t\t\t\t\t\t// Bilevel or Grayscale\r\n\t\t\t\t\t\t\t// WhiteIsZero\r\n\t\t\t\t\t\t\tcase 0:\r\n\t\t\t\t\t\t\t\tif (sampleProperties[0].hasBytesPerSample) {\r\n\t\t\t\t\t\t\t\t\tvar invertValue = Math.pow(0x10, sampleProperties[0].bytesPerSample * 2);\r\n\t\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\t\t// Invert samples.\r\n\t\t\t\t\t\t\t\tpixelSamples.forEach(function(sample, index, samples) { samples[index] = invertValue - sample; });\r\n\r\n\t\t\t\t\t\t\t// Bilevel or Grayscale\r\n\t\t\t\t\t\t\t// BlackIsZero\r\n\t\t\t\t\t\t\tcase 1:\r\n\t\t\t\t\t\t\t\tred = green = blue = this.clampColorSample(pixelSamples[0], sampleProperties[0].bitsPerSample);\r\n\t\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\t\t\t// RGB Full Color\r\n\t\t\t\t\t\t\tcase 2:\r\n\t\t\t\t\t\t\t\tred = this.clampColorSample(pixelSamples[0], sampleProperties[0].bitsPerSample);\r\n\t\t\t\t\t\t\t\tgreen = this.clampColorSample(pixelSamples[1], sampleProperties[1].bitsPerSample);\r\n\t\t\t\t\t\t\t\tblue = this.clampColorSample(pixelSamples[2], sampleProperties[2].bitsPerSample);\r\n\t\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\t\t\t// RGB Color Palette\r\n\t\t\t\t\t\t\tcase 3:\r\n\t\t\t\t\t\t\t\tif (colorMapValues === undefined) {\r\n\t\t\t\t\t\t\t\t\tthrow Error(\"Palette image missing color map\");\r\n\t\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\t\tvar colorMapIndex = pixelSamples[0];\r\n\r\n\t\t\t\t\t\t\t\tred = this.clampColorSample(colorMapValues[colorMapIndex], 16);\r\n\t\t\t\t\t\t\t\tgreen = this.clampColorSample(colorMapValues[colorMapSampleSize + colorMapIndex], 16);\r\n\t\t\t\t\t\t\t\tblue = this.clampColorSample(colorMapValues[(2 * colorMapSampleSize) + colorMapIndex], 16);\r\n\t\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\t\t\t// Transparency mask\r\n\t\t\t\t\t\t\tcase 4:\r\n\t\t\t\t\t\t\t\tthrow RangeError( 'Not Yet Implemented: Transparency mask' );\r\n\t\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\t\t\t// CMYK\r\n\t\t\t\t\t\t\tcase 5:\r\n\t\t\t\t\t\t\t\tthrow RangeError( 'Not Yet Implemented: CMYK' );\r\n\t\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\t\t\t// YCbCr\r\n\t\t\t\t\t\t\tcase 6:\r\n\t\t\t\t\t\t\t\tthrow RangeError( 'Not Yet Implemented: YCbCr' );\r\n\t\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\t\t\t// CIELab\r\n\t\t\t\t\t\t\tcase 8:\r\n\t\t\t\t\t\t\t\tthrow RangeError( 'Not Yet Implemented: CIELab' );\r\n\t\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\t\t\t// Unknown Photometric Interpretation\r\n\t\t\t\t\t\t\tdefault:\r\n\t\t\t\t\t\t\t\tthrow RangeError( 'Unknown Photometric Interpretation:', photometricInterpretation );\r\n\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\tctx.fillStyle = this.makeRGBAFillValue(red, green, blue, opacity);\r\n\t\t\t\t\t\tctx.fillRect(x, yPadding + y, 1, 1);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\tnumRowsInPreviousStrip = numRowsInStrip;\r\n\t\t\t}\r\n\t\t}\r\n\r\n/*\t\tfor (var i = 0, numFileDirectories = this.fileDirectories.length; i < numFileDirectories; i++) {\r\n\t\t\t// Stuff\r\n\t\t}*/\r\n\r\n\t\treturn this.canvas;\r\n\t}\r\n};\r\n\r\nexport default TIFFParser;\n\n\n/** WEBPACK FOOTER **\n ** ./tiff-js/tiff.js\n **/","import * as _ from 'underscore';\r\n\r\nexport default function createQueryString(params) {\r\n    return _.map(params, function (value, key) {\r\n        return encodeURIComponent(key) + '=' + encodeURIComponent(value);\r\n    }).join('&');\r\n}\n\n\n/** WEBPACK FOOTER **\n ** ./src/util/createQueryString.js\n **/","import * as _ from 'underscore';\r\n\r\nvar events = function () {\r\n\r\n    var observers = {};\r\n\r\n    return {\r\n        on: function (event, callback, context) {\r\n            if (!observers[event]) {\r\n                observers[event] = [];\r\n            }\r\n            if (context) {\r\n                callback = callback.bind(context);\r\n            }\r\n            observers[event].push(callback);\r\n        },\r\n        fire: function (event, data) {\r\n            if (observers[event]) {\r\n                _.each(observers[event], function (observer) {\r\n                    observer(event, data);\r\n                });\r\n            }\r\n        }\r\n    };\r\n};\r\n\r\nexport default events;\n\n\n/** WEBPACK FOOTER **\n ** ./src/util/events.js\n **/","import * as _ from 'underscore';\r\nimport {\r\n    Line,\r\n    LineBasicMaterial,\r\n    Geometry,\r\n    Vector3\r\n} from 'three';\r\n\r\nimport clampLineString from './clampLineString';\r\nimport transform from '../util/transform';\r\n\r\nfunction ALine(lineGeom, style, geometry, envelope) {\r\n\r\n    var styleDefaults = {\r\n        color: 0x0000ff,\r\n        linewidth: 5\r\n    };\r\n\r\n    style = _.extend({}, styleDefaults, style || {});\r\n\r\n    var needsClamp = true;\r\n    var line;\r\n\r\n    function _createLine(points, color) {\r\n        var vertices = _.map(points, function (point) {\r\n            return new Vector3(point.x, point.y, point.z);\r\n        });\r\n\r\n        var material = new LineBasicMaterial(style);\r\n        var geometry = new Geometry();\r\n        geometry.vertices = vertices;\r\n        return new Line(geometry, material);\r\n    }\r\n\r\n    function getThreeLine() {\r\n\r\n        if (line) {\r\n            return line;\r\n        }\r\n\r\n        if (lineGeom.type !== 'LineString') {\r\n            throw new Error('Expected GeoJSON LineString geometry');\r\n        }\r\n\r\n        //get envelope stuff\r\n        var coordMinX = envelope.minX();\r\n        var coordMinY = envelope.minY();\r\n\r\n        //get the bbox of the geometry\r\n        geometry.computeBoundingBox();\r\n        var bbox = geometry.boundingBox;\r\n\r\n        var pixelMinX = bbox.min.x;\r\n        var pixelMinY = bbox.min.y;\r\n        var pixelWidth = Math.abs(bbox.max.x - pixelMinX);\r\n        var pixelHeight = Math.abs(bbox.max.y - pixelMinY);\r\n\r\n        var xFactor = envelope.width() / pixelWidth;\r\n        var yFactor = envelope.height() / pixelHeight;\r\n\r\n        var linedata = _.map(lineGeom.coordinates, function (coord) {\r\n            return transform(coord, 'EPSG:4326', envelope.mapCrs);\r\n        });\r\n\r\n        var points = _.map(linedata, function (coord) {\r\n            var x = coord[0];\r\n            var pixelX = pixelMinX + ((x - coordMinX) / xFactor);\r\n            var y = coord[1];\r\n            var pixelY = pixelMinY + ((y - coordMinY) / yFactor);\r\n            return {x: pixelX, y: pixelY, z: 0};\r\n        });\r\n\r\n        if (geometry.loaded) {\r\n            points = clampLineString(points, geometry);\r\n        }\r\n        line = _createLine(points);\r\n\r\n        if (geometry.loaded) {\r\n            needsClamp = false;\r\n        }\r\n        return line;\r\n    };\r\n\r\n    function clamp() {\r\n        line = _createLine(clampLineString(line.geometry.vertices, geometry));\r\n        return line;\r\n    }\r\n\r\n    return {\r\n        getThreeLine: getThreeLine,\r\n        clamp: clamp,\r\n        needsClamp: function needsClamp() {\r\n            return needsClamp;\r\n        }\r\n    };\r\n}\r\n\r\nexport default ALine;\n\n\n/** WEBPACK FOOTER **\n ** ./src/Line/Line.js\n **/","import {Vector3} from 'three';\r\nimport * as _ from 'underscore';\r\n\r\nimport checkIntersect from './checkIntersect';\r\nimport lineIntersect from './lineIntersect';\r\n\r\nfunction calcZ(p1, p2, p3, x, y) {\r\n    var det = (p2.y - p3.y) * (p1.x - p3.x) + (p3.x - p2.x) * (p1.y - p3.y);\r\n    var l1 = ((p2.y - p3.y) * (x - p3.x) + (p3.x - p2.x) * (y - p3.y)) / det;\r\n    var l2 = ((p3.y - p1.y) * (x - p3.x) + (p1.x - p3.x) * (y - p3.y)) / det;\r\n    var l3 = 1.0 - l1 - l2;\r\n    return l1 * p1.z + l2 * p2.z + l3 * p3.z;\r\n}\r\n\r\nfunction getDistance(a, b) {\r\n    return Math.sqrt(Math.pow(a.x - b.x, 2) + Math.pow(a.y - b.y, 2));\r\n}\r\n\r\nfunction clampLineSegment(l, geometry) {\r\n    return _.chain(geometry.faces)\r\n        .map(function (face) {\r\n            var a = geometry.vertices[face.a];\r\n            var b = geometry.vertices[face.b];\r\n            var c = geometry.vertices[face.c];\r\n\r\n            var line1 = [a, b];\r\n            var line2 = [b, c];\r\n            var line3 = [c, a];\r\n\r\n            var ints = [];\r\n            if (checkIntersect(l, line1) ) {\r\n                ints.push(lineIntersect(line1, l));\r\n            }\r\n            if (checkIntersect(l, line2) ) {\r\n                ints.push(lineIntersect(line2, l));\r\n            }\r\n            if (checkIntersect(l, line3) ) {\r\n                ints.push(lineIntersect(line3, l));\r\n            }\r\n            return _.map(ints, function (intersect) {\r\n                var z = calcZ(a, b, c, intersect.x, intersect.y);\r\n                return {\r\n                    x: intersect.x,\r\n                    y: intersect.y,\r\n                    z: z + 0.01,\r\n                    dist: getDistance(l[0], intersect)\r\n                };\r\n            });\r\n        }).\r\n        flatten()\r\n        .sortBy(function (p) {\r\n            return Math.abs(p.dist);\r\n        })\r\n        .value();\r\n}\r\n\r\nfunction clampLineString(line, geometry) {\r\n    var p = _.map(_.range(0, line.length - 1), function (i) {\r\n        var a = line[i];\r\n        var b = line[i + 1];\r\n        return clampLineSegment([a, b], geometry);\r\n    });\r\n    return _.flatten(p);\r\n}\r\n\r\nexport default clampLineString;\n\n\n/** WEBPACK FOOTER **\n ** ./src/Line/clampLineString.js\n **/","// Given three colinear points p, q, r, the function checks if\r\n// point q lies on line segment 'pr'\r\nfunction onSegment(p, q, r) {\r\n    if (q.x <= Math.max(p.x, r.x) && q.x >= Math.min(p.x, r.x) &&\r\n        q.y <= Math.max(p.y, r.y) && q.y >= Math.min(p.y, r.y)) {\r\n        return true;\r\n    }\r\n    return false;\r\n}\r\n\r\n// To find orientation of ordered triplet (p, q, r).\r\n// The function returns following values\r\n// 0 --> p, q and r are colinear\r\n// 1 --> Clockwise\r\n// 2 --> Counterclockwise\r\nfunction orientation(p, q, r) {\r\n    // See http://www.geeksforgeeks.org/orientation-3-ordered-points/\r\n    // for details of below formula.\r\n    var val = (q.y - p.y) * (r.x - q.x) - (q.x - p.x) * (r.y - q.y);\r\n\r\n    if (val === 0) {\r\n        return 0;  // colinear\r\n    }\r\n    return (val > 0) ? 1 : 2; // clock or counterclock wise\r\n}\r\n\r\n// The main function that returns true if line segment 'p1q1'\r\n// and 'p2q2' intersect.\r\nfunction checkIntersect2(l1, l2) {\r\n\r\n    var p1 = l1[0];\r\n    var p2 = l1[1];\r\n\r\n    var q1 = l2[0];\r\n    var q2 = l2[1];\r\n\r\n    // Find the four orientations needed for general and\r\n    // special cases\r\n    var o1 = orientation(p1, q1, p2);\r\n    var o2 = orientation(p1, q1, q2);\r\n    var o3 = orientation(p2, q2, p1);\r\n    var o4 = orientation(p2, q2, q1);\r\n    // General case\r\n    if (o1 !== o2 && o3 !== o4) {\r\n        return true;\r\n    }\r\n\r\n    // Special Cases\r\n    // p1, q1 and p2 are colinear and p2 lies on segment p1q1\r\n    if (o1 === 0 && onSegment(p1, p2, q1)) {\r\n        return true;\r\n    };\r\n\r\n    // p1, q1 and p2 are colinear and q2 lies on segment p1q1\r\n    if (o2 === 0 && onSegment(p1, q2, q1)) {\r\n        return true;\r\n    }\r\n\r\n    // p2, q2 and p1 are colinear and p1 lies on segment p2q2\r\n    if (o3 === 0 && onSegment(p2, p1, q2)) {\r\n        return true;\r\n    }\r\n     // p2, q2 and q1 are colinear and q1 lies on segment p2q2\r\n    if (o4 === 0 && onSegment(p2, q1, q2)) {\r\n        return true;\r\n    }\r\n\r\n    return false; // Doesn't fall in any of the above cases\r\n}\r\n\r\nfunction Turn(p1, p2, p3) {\r\n  var a = p1.x;\r\n  var b = p1.y;\r\n  var c = p2.x;\r\n  var d = p2.y;\r\n  var e = p3.x;\r\n  var f = p3.y;\r\n  var A = (f - b) * (c - a);\r\n  var B = (d - b) * (e - a);\r\n  return (A > B + Number.EPSILON) ? 1 : (A + Number.EPSILON < B) ? -1 : 0;\r\n}\r\n\r\nfunction checkIntersect(l1, l2) {\r\n    var p1 = l1[0];\r\n    var p2 = l1[1];\r\n    var p3 = l2[0];\r\n    var p4 = l2[1];\r\n  return (Turn(p1, p3, p4) !== Turn(p2, p3, p4)) && (Turn(p1, p2, p3) !== Turn(p1, p2, p4));\r\n}\r\n\r\nexport default checkIntersect;\n\n\n/** WEBPACK FOOTER **\n ** ./src/Line/checkIntersect.js\n **/","export default function lineIntersect(l1, l2) {\r\n    var x1 = l1[0].x;\r\n    var y1 = l1[0].y;\r\n\r\n    var x2 = l1[1].x;\r\n    var y2 = l1[1].y;\r\n\r\n    var x3 = l2[0].x;\r\n    var y3 = l2[0].y;\r\n\r\n    var x4 = l2[1].x;\r\n    var y4 = l2[1].y;\r\n    var ua, ub, denom = (y4 - y3) * (x2 - x1) - (x4 - x3) * (y2 - y1);\r\n    if (denom === 0) {\r\n        return null;\r\n    }\r\n    ua = ((x4 - x3) * (y1 - y3) - (y4 - y3) * (x1 - x3)) / denom;\r\n    ub = ((x2 - x1) * (y1 - y3) - (y2 - y1) * (x1 - x3)) / denom;\r\n    return {\r\n        x: x1 + ua * (x2 - x1),\r\n        y: y1 + ua * (y2 - y1),\r\n        z: 0\r\n    };\r\n}\r\n\n\n\n/** WEBPACK FOOTER **\n ** ./src/Line/lineIntersect.js\n **/","import proj4 from 'proj4/lib/index';\r\nproj4.defs('EPSG:32632', '+title=EPSG Projection 32632 - WGS 84 / UTM zone 32N +proj=utm +zone=32 +ellps=WGS84 +datum=WGS84 +units=m +no_defs');\r\nproj4.defs('EPSG:32633', '+title=EPSG Projection 32633 - WGS 84 / UTM zone 33N +proj=utm +zone=33 +ellps=WGS84 +datum=WGS84 +units=m +no_defs');\r\n\r\nexport default function transform(coord, from, to) {\r\n    return proj4(from, to, coord);\r\n}\n\n\n/** WEBPACK FOOTER **\n ** ./src/util/transform.js\n **/","module.exports = proj4;\n\n\n/*****************\n ** WEBPACK FOOTER\n ** external \"proj4\"\n ** module id = 13\n ** module chunks = 0\n **/","import {\r\n    TextureLoader,\r\n    LinearFilter\r\n} from 'three';\r\n\r\nimport createQueryString from './util/createQueryString';\r\n\r\nfunction Texture(textureConfig, dim) {\r\n\r\n    function _getImageMap() {\r\n        var imageCall;\r\n        if (textureConfig.imgUrl) { //IMAGE\r\n            return textureConfig.imgUrl;\r\n        }\r\n        var params = {\r\n            service: 'wms',\r\n            version: '1.3.0',\r\n            request: 'getMap',\r\n            crs: dim.crs,\r\n            WIDTH: dim.imgWidth,\r\n            HEIGHT: dim.imgHeight,\r\n            bbox: dim.envelope.bbox(),\r\n            layers: textureConfig.wmsLayers,\r\n            format: textureConfig.wmsFormat + textureConfig.wmsFormatMode\r\n        };\r\n        return textureConfig.wmsUrl + '?' + createQueryString(params);\r\n    };\r\n\r\n    function loadTexture(material, callback) {\r\n        var loader = new TextureLoader(),\r\n            image = _getImageMap();\r\n        // load a resource\r\n        loader.load(\r\n            image,\r\n            function (texture) {\r\n                //Texture is probably not the power of two.\r\n                //Avoid warning: Apply THREE.LinearFilter or THREE.NearestFilter\r\n                texture.minFilter = LinearFilter;\r\n                material.map = texture;\r\n                material.needsUpdate = true;\r\n                if (callback) {\r\n                    callback(texture);\r\n                }\r\n            },\r\n            // Function called when download progresses\r\n            function (xhr) {},\r\n            // Function called when download errors\r\n            function (xhr) {\r\n                console.log('An error happened on texture load: ' + image);\r\n            }\r\n        );\r\n    };\r\n    return {\r\n        loadTexture: loadTexture\r\n    };\r\n}\r\n\r\nexport default Texture;\n\n\n/** WEBPACK FOOTER **\n ** ./src/Texture.js\n **/","import {\r\n    PlaneGeometry,\r\n    MeshBasicMaterial,\r\n    DoubleSide,\r\n    BackSide,\r\n    Geometry,\r\n    Vector3,\r\n    Face3,\r\n    Group,\r\n    Mesh\r\n} from 'three';\r\nimport * as _ from 'underscore';\r\n\r\nimport TIFFParser from './../tiff-js/tiff.js';\r\n\r\nimport createQueryString from './util/createQueryString';\r\n\r\n\r\nvar Terrain = function (terrainConfig, dim) {\r\n\r\n    var isTiff = (terrainConfig.format === 'geotiff');\r\n    var geometry;\r\n    var minHeight, midHeight;\r\n\r\n    function _getTiffHeights(xhr) {\r\n        var tiffParser = new TIFFParser();\r\n        var tiffArray = tiffParser.parseTIFF(xhr.response);\r\n        var i = -1;\r\n        var heights = [];\r\n        for (var j = 0; j < tiffArray.length; j++) {\r\n            for (var k = 0; k < tiffArray[j].length; k++) {\r\n                heights.push(parseInt(tiffArray[j][k][0], 10));\r\n            }\r\n        }\r\n        return heights;\r\n    }\r\n\r\n    function _getXYZHeights(xhr) {\r\n        var numVertices = geometry.vertices.length;\r\n        var lines = xhr.responseText.split('\\n');\r\n        var heights = [];\r\n        for (var i = 0, l = numVertices; i < l; i++) {\r\n            heights[i] = parseInt(lines[i].split(' ')[2], 10);\r\n        }\r\n        return heights;\r\n    }\r\n\r\n    function _parseHeights(xhr) {\r\n\r\n        var heights = isTiff\r\n            ? _getTiffHeights(xhr)\r\n            : _getXYZHeights(xhr);\r\n\r\n        var minHeight = _.min(heights);\r\n        var maxHeight = _.max(heights);\r\n\r\n        //The Vertical center of the height model is adjusted to (min + max) / 2.\r\n        //If the map covers an area of high altitudes (i.e. Galdhpiggen) above sea level,\r\n        //a tipping of the model will cause the map to disappear over the screen top without this\r\n        //adjustment.\r\n        //On a computer you can move the model down width a right-click-drag,\r\n        //but not on a mobile device.\r\n        var midHeight = (maxHeight + minHeight) / 2;\r\n\r\n        return {\r\n            height: heights,\r\n            midHeight: midHeight,\r\n            minHeight: ((minHeight - midHeight) / dim.zMult)\r\n        };\r\n    };\r\n\r\n    function _createGeometry() {\r\n        geometry = new PlaneGeometry(\r\n            dim.demWidth,\r\n            dim.demHeight,\r\n            dim.demWidth - 1,\r\n            dim.demHeight - 1\r\n        );\r\n    };\r\n\r\n    function _terrainLoaded(data) {\r\n        for (var i = 0, l = geometry.vertices.length; i < l; i++) {\r\n            geometry.vertices[i].z = ((data.height[i] - data.midHeight) / dim.zMult);\r\n        }\r\n        geometry.loaded = true;\r\n        geometry.verticesNeedUpdate = true;\r\n        minHeight = data.minHeight;\r\n        midHeight = data.midHeight;\r\n    }\r\n\r\n    function loadTerrain(callback) {\r\n        var demRequest = new XMLHttpRequest();\r\n\r\n        var params = {\r\n            SERVICE: 'WCS',\r\n            VERSION: '1.0.0',\r\n            REQUEST: 'GetCoverage',\r\n            COVERAGE: terrainConfig.coverage,\r\n            FORMAT: terrainConfig.format,\r\n            bbox: dim.envelope.bbox(),\r\n            CRS: dim.crs,\r\n            RESPONSE_CRS: dim.crs,\r\n            WIDTH: dim.demWidth,\r\n            HEIGHT: dim.demHeight\r\n        };\r\n\r\n        var wcsCall = terrainConfig.wcsUrl + '?' + createQueryString(params);\r\n        if (isTiff) {\r\n            demRequest.responseType = 'arraybuffer';\r\n        }\r\n        demRequest.open('GET', wcsCall, true);\r\n        demRequest.onreadystatechange = function () {\r\n            if (this.readyState === 4) {\r\n                _terrainLoaded(_parseHeights(this));\r\n                callback();\r\n            }\r\n        };\r\n        demRequest.send();\r\n    };\r\n\r\n    function _createSideMesh(filter) {\r\n        var points = _.chain(geometry.vertices)\r\n            .filter(filter)\r\n            .map(function (vertex) {\r\n                return [\r\n                    new Vector3(vertex.x, vertex.y, vertex.z),\r\n                    new Vector3(vertex.x, vertex.y, minHeight)\r\n                ];\r\n            })\r\n            .flatten()\r\n            .value();\r\n        var first = _.first(points).clone();\r\n        var last = _.last(points).clone();\r\n        first.z = minHeight;\r\n        last.z = minHeight;\r\n\r\n        var sideGeometry = new Geometry();\r\n        points.unshift(first);\r\n        points.push(last);\r\n\r\n        var faces = _.map(_.range(1, points.length - 1), function (i) {\r\n            return new Face3(i - 1, i, i + 1);\r\n        });\r\n\r\n        sideGeometry.vertices = points;\r\n        sideGeometry.faces = faces;\r\n        return new Mesh(sideGeometry, new MeshBasicMaterial({\r\n            side: DoubleSide,\r\n            color: terrainConfig.boxColor,\r\n            wireframe: false\r\n        }));\r\n    }\r\n\r\n    function getSides() {\r\n        if (!terrainConfig.showBox) {\r\n            return null;\r\n        }\r\n        var material = new MeshBasicMaterial({\r\n            wireframe: false,\r\n            color: terrainConfig.boxColor,\r\n            side: BackSide\r\n        });\r\n\r\n        var backGeom = new PlaneGeometry(\r\n            dim.demWidth,\r\n            dim.demHeight,\r\n            dim.demWidth - 1,\r\n            dim.demHeight - 1\r\n        );\r\n\r\n        for (var i = 0, l = backGeom.vertices.length; i < l; i++) {\r\n            backGeom.vertices[i].z = minHeight;\r\n        }\r\n\r\n        var group = new Group();\r\n        group.add(new Mesh(backGeom, material));\r\n\r\n        geometry.computeBoundingBox();\r\n        var bbox = geometry.boundingBox;\r\n\r\n        var filterLeft = function (vertex) {\r\n            return vertex.x === bbox.min.x;\r\n        };\r\n\r\n        var filterBottom = function (vertex) {\r\n            return vertex.y === bbox.min.y;\r\n        };\r\n\r\n        var filterRight = function (vertex) {\r\n            return vertex.x === bbox.max.x;\r\n        };\r\n\r\n        var filterTop = function (vertex) {\r\n            return vertex.y === bbox.max.y;\r\n        };\r\n\r\n        group.add(_createSideMesh(filterBottom));\r\n        group.add(_createSideMesh(filterRight));\r\n        group.add(_createSideMesh(filterLeft));\r\n        group.add(_createSideMesh(filterTop));\r\n        return group;\r\n    }\r\n\r\n    _createGeometry();\r\n\r\n    return {\r\n        loadTerrain: loadTerrain,\r\n        getGeometry: function getGeometry() {\r\n            return geometry;\r\n        },\r\n        minHeight: function () {\r\n            return minHeight;\r\n        },\r\n        midHeight: function () {\r\n            return midHeight;\r\n        },\r\n        getSides: getSides,\r\n\r\n        showBox: terrainConfig.showBox\r\n    };\r\n};\r\n\r\nexport default Terrain;\n\n\n/** WEBPACK FOOTER **\n ** ./src/Terrain.js\n **/","import * as _ from 'underscore';\r\nimport {\r\n    PlaneGeometry,\r\n    MeshPhongMaterial,\r\n    Mesh,\r\n    DoubleSide\r\n} from 'three';\r\n\r\nimport Texture from './Texture';\r\nimport transform from './util/transform';\r\n\r\nfunction Profiles(profiles, terrain, dim) {\r\n\r\n    function _transformPoint(sSource, sDest, x, y) {\r\n        if (typeof x === 'string') {\r\n            x = 1.0 * x;\r\n            y = 1.0 * y;\r\n        }\r\n        return transform([x, y], sSource, sDest);\r\n    };\r\n\r\n    function _createProfile(profile, config) {\r\n            var verticalGeometry = new PlaneGeometry(1, 1);\r\n            var verticalMaterial = new MeshPhongMaterial({\r\n                side: DoubleSide,\r\n                transparent: true\r\n            });\r\n            var crsSource = profile.CRS;\r\n\r\n            //Check and transform to another map projection\r\n\r\n            if (crsSource !== config.crsDestination) {\r\n                var pointStart = _transformPoint(crsSource, config.crsDestination, profile.xyStart.x, profile.xyStart.y),\r\n                    pointEnd = _transformPoint(crsSource, config.crsDestination, profile.xyEnd.x, profile.xyEnd.y);\r\n                    profile.xyStart.x = pointStart[0];\r\n                    profile.xyStart.y = pointStart[1];\r\n                    profile.xyEnd.x = pointEnd[0];\r\n                    profile.xyEnd.y = pointEnd[1];\r\n            }\r\n\r\n            //Local transformation\r\n            var newStartX = config.kX * profile.xyStart.x - config.kX * dim.envelope.minX() - (dim.demWidth / 2),\r\n                newStartY = config.kY * profile.xyStart.y - config.kY * dim.envelope.minY() - (dim.demHeight / 2),\r\n                newEndX = config.kX * profile.xyEnd.x - config.kX * dim.envelope.minX() - (dim.demWidth / 2),\r\n                newEndY = config.kY * profile.xyEnd.y - config.kY * dim.envelope.minY() - (dim.demHeight / 2),\r\n                newStartZ = profile.zStart - terrain.midHeight(),\r\n                newEndZ = profile.zEnd - terrain.midHeight(),\r\n                verticalMesh = new Mesh(verticalGeometry, verticalMaterial);\r\n\r\n            //XY\r\n            verticalMesh.geometry.vertices[0].x = newStartX;\r\n            verticalMesh.geometry.vertices[0].y = newStartY;\r\n            verticalMesh.geometry.vertices[1].x = newEndX;\r\n            verticalMesh.geometry.vertices[1].y = newEndY;\r\n            verticalMesh.geometry.vertices[2].x = newStartX;\r\n            verticalMesh.geometry.vertices[2].y = newStartY;\r\n            verticalMesh.geometry.vertices[3].x = newEndX;\r\n            verticalMesh.geometry.vertices[3].y = newEndY;\r\n\r\n            //Z\r\n            profile.zStart - terrain.midHeight();\r\n            verticalMesh.geometry.vertices[0].z = newStartZ / dim.zMult; //900/zMult;\r\n            verticalMesh.geometry.vertices[1].z = newStartZ / dim.zMult; //900/zMult;//\r\n            verticalMesh.geometry.vertices[2].z = newEndZ / dim.zMult; //-1406/zMult;\r\n            verticalMesh.geometry.vertices[3].z = newEndZ / dim.zMult; //-1406/zMult;\r\n\r\n\r\n            var texture = Texture({\r\n                type: 'image',\r\n                imgUrl: profile.imgUrl\r\n            }, null);\r\n            texture.loadTexture(verticalMaterial);\r\n\r\n            return verticalMesh;\r\n    }\r\n\r\n    function load(callback) {\r\n        //json response for profile metadata db query\r\n        var geometry = terrain.getGeometry();\r\n        var modelLL = geometry.vertices[geometry.vertices.length - dim.demWidth];\r\n        var modelUR = geometry.vertices[dim.demWidth - 1];\r\n        var data = {\r\n            crsDestination: dim.crs,\r\n            kX: ((modelUR.x - modelLL.x) / dim.envelope.width()),\r\n            kY: ((modelUR.y - modelLL.y) / dim.envelope.height())\r\n        };\r\n\r\n        var meshes = _.map(profiles, function (profile) {\r\n            return _createProfile(profile, data);\r\n        });\r\n\r\n        callback(meshes);\r\n    }\r\n\r\n    return {\r\n        load: load\r\n    };\r\n}\r\n\r\nexport default Profiles;\n\n\n/** WEBPACK FOOTER **\n ** ./src/Profiles.js\n **/","import * as _ from 'underscore';\r\n\r\nimport transform from './util/transform';\r\n\r\nexport default function Envelope(bbox, crs, bboxCrs) {\r\n    var bbox = _.map(bbox.split(','), parseFloat);\r\n    var ne = [bbox[0], bbox[1]];\r\n    var sw = [bbox[2], bbox[3]];\r\n    if (crs !== bboxCrs) {\r\n        ne = transform(ne, bboxCrs, crs);\r\n        sw = transform(sw, bboxCrs, crs);\r\n    }\r\n\r\n    var envelope = ne.concat(sw);\r\n\r\n    function width() {\r\n        return envelope[2] - envelope[0];\r\n    }\r\n\r\n    function height() {\r\n        return envelope[3] - envelope[1];\r\n    }\r\n\r\n    function getBbox() {\r\n        return envelope.join(',');\r\n    }\r\n\r\n    function minX() {\r\n        return envelope[0];\r\n    }\r\n\r\n    function minY() {\r\n        return envelope[1];\r\n    }\r\n\r\n    return {\r\n        width: width,\r\n        height: height,\r\n        bbox: getBbox,\r\n        minX: minX,\r\n        minY: minY,\r\n        mapCrs: crs\r\n    };\r\n}\r\n\n\n\n/** WEBPACK FOOTER **\n ** ./src/Envelope.js\n **/"],"sourceRoot":""}